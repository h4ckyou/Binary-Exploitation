<h2> ROP Emporium </h2>

    - Challenge 2
    - Chall Name: split

![image](https://github.com/h4ckyou/Binary-Exploitation/assets/127159644/8f41bf90-3d81-420c-a0c1-0ea2e3f54415)

**File Checks:-**
![image](https://github.com/h4ckyou/Binary-Exploitation/assets/127159644/e9dbcc26-35a4-40ed-adc7-410c22cd25ec)

We are working with a x64 binary which is dynamically linked and not stripepd, the only protection there is **NX**

Running the binary shows this
![image](https://github.com/h4ckyou/Binary-Exploitation/assets/127159644/52befd28-4fbd-4141-89bb-4dda18216e7f)

It just receives our input then exits

Decompiling with Ghidra here's the main function
![image](https://github.com/h4ckyou/Binary-Exploitation/assets/127159644/a6c1f35e-cf41-457a-96ae-6c799ea46f8f)

Nothing really interesting aside it calling the `pwnme()` function

Here's the decompilation for the function
![image](https://github.com/h4ckyou/Binary-Exploitation/assets/127159644/0847dbbc-c6b2-42e0-8936-945d277b6fc9)

So we have a buffer overflow here because it's reading in at most 96 bytes into a buffer that can only hold up 32 bytes

Looking through available function shows this
![image](https://github.com/h4ckyou/Binary-Exploitation/assets/127159644/7622ffbf-4d64-4140-bc89-82df7c95d9ee)

This function isn't called by `main() or pwnme()` so our goal would be to call it right?

But the issue here is that when we call it, it would instead run `/bin/ls` rather than concatenating the flag file

How do we solve this?

Looking through the data section I found a string 
![image](https://github.com/h4ckyou/Binary-Exploitation/assets/127159644/7957d5b7-46cd-434a-b789-f1a509b4bcb4)

So at the elf symbol `usefulString` holds the string `/bin/cat flag.txt`

Now what I will do is to call the `system` function passing that string as the parameter

But note that I won't be passing a direct string but rather an address pointing to that string which in this case is the symbol **usefulString**

How do we call `system` when we don't have access to it?

Well because it's already resolved from the `libc` library file we would have access to call it

You can check the `got.plt` section to know what libc functions are being resolved
![image](https://github.com/h4ckyou/Binary-Exploitation/assets/127159644/099e20ba-ef40-4a46-bd19-449619859982)

Next thing is how do we pass that address to the string as the argument to that system function?

On x64 arch, arguments are passed to function via the registers

```
arg1 == rdi
arg2 == rsi
arg3 == rdx
arg4 == rcx
arg5 == r8
arg6 == r9
```

But if the arguments are more than that then it uses the stack for the remaining arguments

So we need to look for gadgets that allows us control the *rdi* register cause we just need to pass in just one value as the argument to that function

Using `ropper` tool I got various gadgets
![image](https://github.com/h4ckyou/Binary-Exploitation/assets/127159644/93f37ce9-8f77-45b5-bb04-1870f422083c)
![image](https://github.com/h4ckyou/Binary-Exploitation/assets/127159644/b34e440b-e28b-46ba-adcf-27e16ee7c65a)

Looking through I found a gadget that let's me control the *rdi* register

```
0x00000000004007c3: pop rdi; ret; 
```






